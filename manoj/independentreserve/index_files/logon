window.IR==null&&(window.IR={}),function(n){function t(t){function tt(){return i=n.extend(!0,bt,t||{}),rt(),ft(),ot(),st(),wt}function it(){var t=n("#passwordResetForm [name=NewPassword]").attr("data-password-strength");return{IsValid:t!=="Weak",Message:i.calculator.error.message,AutoHide:i.calculator.error.autoHide}}function e(t){n("#theLoginForm .session-expired-message").toggle(t);n("#theLoginForm .message-container").toggle(t)}function w(t){n("#theLoginForm .log-on-message").toggle(t);n("#theLoginForm .message-container").toggle(t)}function b(t,i){var r=n("#theLoginForm .logon-required-reason-{0}".f(t));r.length&&(r.toggle(i),n("#theLoginForm .message-container").toggle(i))}function c(t){n("#passwordResetForm .reset-password-message").toggle(t);n("#passwordResetForm .message-container").toggle(t)}function rt(){r=new IR.Captcha({isValidated:i.captcha.isValidated,data:{getDataUrl:i.captcha.getDataUrl},captchaInvalid:i.captcha.invalidMessage,captchaEmpty:i.captcha.emptyMessage})}function ut(t){var a=n.getUrlVariable("ReturnUrl"),p,c,l,s,o,h;t.Success?(window.tokenChanged(),p=t.UserType=="Pending"&&t.IsFastTrack,t.AccountSetupRequired?n.redirect(i.login.settingsPageUrl):a?n.redirect(a+window.location.hash):t.UserType=="Standard"||p?n.redirect(i.login.tradePageUrl):n.reload()):(c=t.IsSuspended,l=t.DeviceNotAvailableFor2fa,e(!1),t.Status==i.login.additionalInfoRequiredStatus?(u("Security Check",i.login.additionalInfoRequiredMessage,!1),y=!0,k(t,f),n("#theLoginForm .additionalInfoRequiredFields").show()):t.Status==i.login.pendingSecondaryAuthStatus?ht():t.Status===i.login.pendingBrowserConfirmationStatus?ct(t.Status):(s=c?null:y?i.login.withDateOfBirthDescription:i.login.withoutDateOfBirthDescription,o="Invalid Credentials",n.log(l),l&&(s=i.login.deviceNotAvailableFor2faDescription,o="SMS has been disabled for 2FA on this account"),!t.Message&&n("#theLoginForm [name=Code]").val()?u("Log on Failed",i.login.loginFailedMessage,!0,!1,s,o):(n.log(o),h=t.Message==i.captcha.emptyMessage,u("Log on Failed",t.Message,!0,h,h?null:s,h?null:o)),k(t,f)),r.isInvalidMessage(t.Message)&&(r.setValidated(!1),g()),t.Message==i.login.ipAddressProhibited||c||nt("#theLoginForm"),v())}function k(n,t){n&&n.RecaptchaIsRequired===!0&&t.show()}function ft(){var o=n.getUrlVariable("ReturnUrl"),r=n.getUrlVariable("reason"),s=n.getUrlVariable("emailConfirm"),t;n(".show-other-options").click(function(){var t=n(this).closest("form");t.find(".otherAuthOptions").show();t.find("input[type=radio][name=TwoFactorAuthenticationType][value=PrimaryPhone]").click();t.find(".googleAuthCodeWrapper").hide()});n(".otherAuthOptions [name=TwoFactorAuthenticationType][value=GoogleAuth]").click(a);n(".otherAuthOptions .radio a").click(a);n(".otherAuthOptions [name=TwoFactorAuthenticationType]").change(function(){var r=n(this),t=r.closest("form"),i=t.find(".otherAuthOptions [name=TwoFactorAuthenticationType]:checked").val();(i=="PrimaryPhone"||i=="SecondaryPhone")&&g(t)});t=n("#theLoginForm");f=new IR.RecaptchaManager({wrapperId:"recaptcha-login"});i.login.hideRecaptcha&&f.hide();t.ajaxForm({beforeSend:function(){n("#theLoginForm input[type=submit]").addClass("disabled")},success:ut,error:function(n){e(!1);var t="Try again later.";n&&n.status===429&&(t="Too many logon attempts. Please try again in 15 minutes");u("Log on Failed",t,!0,!1)}});n("#theLoginForm input[type=submit]").click(function(){var r,i;if(!n(this).hasClass("disabled")&&f.isValid()){if(r=n("#theLoginForm [name=CaptchaInputText]"),r.is(":visible")&&!r.irValidate()){n(this).removeClass("disabled");return}if(i=n("#theLoginForm [name=Code]:visible"),n("#theLoginForm [name=CodeHasValue]").val(i.length!=0),i.length&&!i.irValidate())return;t.find("[name=Login]").irValidate()&&t.find("[name=Password]").irValidate()&&t.submit()}});et();o&&e(!0);r&&b(r);s=="True"&&(e(!1),b("email-confirm"));n(document).keydown(function(t){if(t.keyCode==27){var i=n("#theloginformdialog");i.is(":visible")&&(i.find("form#theLoginForm").is(":visible")?AAT.utils.hideModal():n(".btn-cancel-reset-password").click())}})}function et(){s();n("#theLoginForm .otherAuthOptions").hide();n("#theLoginForm .googleAuthCodeWrapper").show();u("Log On","");n("#theLoginForm .log-on-message").hide();u("Log On","",!1);n("#theLoginForm [name=Login]").prop("readonly",!1).val("").focus();n("#theLoginForm [name=Password]").prop("readonly",!1).val("");v();n("#theLoginForm [name=TwoFactorAuthenticationType][value=GoogleAuth]").prop("checked",!0);n("#theLoginForm .sms-code-confirmation").hide();n("#theLoginForm [name=Code]").val("")}function d(t){var u=n("#passwordResetForm .current-step").val(),f;t.Success?(1==u?vt(t.RequireEmailCode,t.RequirePrimarySmsCode,t.RequireSecondarySmsCode,t.Description):yt(),o("")):(o(t.Message,t.FieldName,1==u?i.resetPassword.invalidCredentialsDescription:t.Description),f=t.IsSuspended,f?pt("#passwordResetForm"):nt("#passwordResetForm"),r.isInvalidMessage(t.Message)&&(r.setValidated(!1),r.request("#passwordResetForm"),r.show("#passwordResetForm")));h.reset();v()}function ot(){n("#theLoginForm .btn-reset-password").click(lt);n(".btn-cancel-reset-password").click(s);n("#passwordResetForm").ajaxForm({beforeSend:function(){n("#passwordResetForm input[type=submit]").addClass("disabled")},success:d,failed:d,error:function(){o("Try again later")}});n("#passwordResetForm [name=NewPassword]").passwordMeter({calculator:i.calculator});h=new IR.RecaptchaManager({wrapperId:"recaptcha-reset-password"});n("#passwordResetForm input[type=submit]").click(function(){if(!n(this).hasClass("disabled")){var t=n("#passwordResetForm .current-step").val();(1==t&&n("#passwordResetForm [name=Login]").irValidate()&&n("#passwordResetForm select.day").irValidate()&&n("#passwordResetForm select.month").irValidate()&&n("#passwordResetForm select.year").irValidate()&&n("#passwordResetForm [name=PostalCode]").irValidate()&&(!n("#passwordResetForm [name=CaptchaInputText]").is(":visible")||n("#passwordResetForm [name=CaptchaInputText]").irValidate())&&h.isValid()||2==t&&(!n("#passwordResetForm .emailrequired").is(":visible")||n("#passwordResetForm .emailrequired").irValidate())&&(!n("#passwordResetForm .primarysmsrequired").is(":visible")||n("#passwordResetForm .primarysmsrequired").irValidate())&&(!n("#passwordResetForm .secondarysmsrequired").is(":visible")||n("#passwordResetForm .secondarysmsrequired").irValidate())&&n("#passwordResetForm [name=NewPassword]").irValidate()&&n("#passwordResetForm [name=RepeatNewPassword]").irValidate())&&n("#passwordResetForm").submit()}})}function st(){n("#theLoginForm .btn-forgotten-username").click(at);n(".btn-cancel-forgotten-username").click(s);var t=n("#forgotten-username"),i=t.find("input[type=submit]");t.ajaxForm({beforeSend:function(){i.addClass("disabled")},success:function(n){n.Success?(t.find(".enter-data").hide(),t.find(".success").show()):t.errorMessage({error:n});i.removeClass("disabled")},error:function(){n.log("Exception occured while calling forgotten username feature");i.removeClass("disabled")}});p=new IR.RecaptchaManager({wrapperId:"recaptcha-forgotten-username"});i.click(function(){if(!n(this).hasClass("disabled")&&t.find("[name=EmailAddress]").irValidate()&&t.find("select.day").irValidate()&&t.find("select.month").irValidate()&&t.find("select.year").irValidate()&&p.isValid())t.submit();else return!1})}function u(t,i,u,e,o,s){s=s||"Invalid Credentials";f.reset();var c=n("#theLoginForm .log-on-message"),h=n(".log-on-message-description");i&&i!=""?(c.toggleClass("danger",u).toggleClass("alert-danger",!e).toggleClass("alert-info",e).find("span").html(i),w(!0),o?(h.attr("data-original-title",s),h.attr("data-content",o).show()):h.hide(),r.isVisible("#theLoginForm")?r.request("#theLoginForm"):n("#theLoginForm input[type=submit]").removeClass("disabled")):(w(!1),n("#theLoginForm input[type=submit]").removeClass("disabled"))}function o(t,i,u){var e=n(".reset-password-message"),f=n(".reset-password-description"),o=n(".reset-password-message-container");t&&t!=""?(i?c(!1):c(!0),n("#passwordResetForm .alert-info.step-2").hide(),n("#passwordResetForm").errorMessage({dialog:".reset-password-message span",error:{Message:t,FieldName:i}}),r.isVisible("#passwordResetForm")&&r.request("#passwordResetForm")):(e.hide(),c(!1));n("#passwordResetForm input[type=submit]").removeClass("disabled");u?f.attr("data-content",u).show():f.hide()}function ht(){u("Log On","",!1);n("#theLoginForm [name=Login]").prop("readonly",!0);n("#theLoginForm [name=Password]").prop("readonly",!0);n("#theLoginForm .otherAuthOptions").hide();n("#theLoginForm .sms-code-confirmation").show();n("#theLoginForm [name=Code]").val("").focus()}function ct(t){n("#theLoginForm").hide();n("#forgotten-username").hide();n("#passwordResetForm").hide();n(`[data-status-specific=${t}]`).show()}function lt(){h.reset();e(!1);n("#theLoginForm").hide();n("#passwordResetForm [name=Login]").val(n("#theLoginForm [name=Login]").val());n("#passwordResetForm [name=Login]").prop("readonly",!1);n("#passwordResetForm [name=DateOfBirth]").val("");n("#passwordResetForm select").val("");n("#passwordResetForm").fillData({PostalCode:"",EmailCode:"",PrimarySmsCode:"",NewPassword:"",RepeatNewPassword:""});n("#passwordResetForm .current-step").val(1);o("");l();n("#passwordResetForm .step-2").hide();n("#passwordResetForm .step-1").show();n("#passwordResetForm").attr("action",i.resetPassword.resetPasswordChallengeUrl);n("#passwordResetForm [name=TwoFactorAuthenticationType][value=GoogleAuth]").prop("checked",!0).click();n("#passwordResetForm").show();n("#passwordResetForm [name=Login]").focus()}function at(){p.reset();e(!1);n("#theLoginForm").hide();var t=n("#forgotten-username");t.find(".enter-data").show();t.find(".success").hide();t.find("select").val("");t.fillData({EmailAddress:"",DateOfBirth:""});t.show();t.find("[name=EmailAddress]").focus()}function vt(t,r,u,f){n("#passwordResetForm .step-1").hide();n("#passwordResetForm .alert-info.step-2").text(f);n("#passwordResetForm .step-2").show();n("#passwordResetForm").attr("action",i.resetPassword.resetPasswordUrl);var e=!1;t?(n("#passwordResetForm .emailrequired").show(),n("#passwordResetForm .emailrequired input").focus(),e=!0):n("#passwordResetForm .emailrequired").hide();r?(n("#passwordResetForm .primarysmsrequired").show(),e||(n("#passwordResetForm .primarysmsrequired input").focus(),e=!0)):n("#passwordResetForm .primarysmsrequired").hide();u?(n("#passwordResetForm .secondarysmsrequired").show(),e||(n("#passwordResetForm .secondarysmsrequired input").focus(),e=!0)):n("#passwordResetForm .secondarysmsrequired").hide();e||n("#passwordResetForm input[name=NewPassword]").focus();n("#passwordResetForm [name=Login]").prop("readonly",!0);n("#passwordResetForm .current-step").val(2);n("#passwordResetForm").fillData({PrimarySmsCode:"",SecondarySmsCode:"",EmailCode:"",NewPassword:"",RepeatNewPassword:""});o("")}function s(){f.reset();a();n("#theLoginForm .sms-code-confirmation").hide();n("#theLoginForm [name=Code]").val("");n("#passwordResetForm").hide();l();n("#theLoginForm").show();n("#theLoginForm [name=TwoFactorAuthenticationType][value=GoogleAuth]").prop("checked",!0).click();y=!1;n("#theLoginForm .additionalInfoRequiredFields").hide();n("#theLoginForm .additionalInfoRequiredFields").find("input").val("");n("#theLoginForm .additionalInfoRequiredFields").find("select").val("");n("#forgotten-username").hide()}function yt(){s();n("#theLoginForm [name=Login]").val(n("#passwordResetForm [name=Login]").val());n("#theLoginForm [name=Password]").val("").focus();u("Log On","Your password has been changed.",!1)}function l(){r.clear("#theLoginForm");r.clear("#passwordResetForm")}function g(n){r.isVisible(n)||(r.show(n),r.request(n))}function a(){var i=n(this),t=i.closest("form");l();t.find(".otherAuthOptions").hide();r.hide(t);t.find(".googleAuthCodeWrapper").show();t.find("input[type=submit]").removeClass("disabled").prop("disabled",!1);i.parent().children("input").prop("checked",!0)}function v(){n("[name=GoogleAuthCode]").val("")}function nt(t){var r=n("[name=GoogleAuthCode]",t),i,u;r.is(":visible")&&!r.val()&&(i=n("[data-toggle=error-message] span",t),u=i.html(),i.html(u+'<p class="additional-note">Two-factor authentication code must be entered if you have it enabled.<\/p>'))}function pt(t){var i=n("[data-toggle=error-message] span",t),r=n(".reset-password-description",t),u=i.html();i.html(u+'<p class="additional-note">Password cannot be reset for a suspended account.<\/p>');r.hide()}var wt={validatePasswordStrength:it},i,bt={},r,y=!1,h=null,p=null,f=null;return tt()}n.extend(!0,IR,{LogonControl:t})}(jQuery);window.IR==null&&(window.IR={}),function(n){function t(t){function o(){return r=n.extend(!0,v,t||{}),f=new IR.RecaptchaManager({wrapperId:"recaptcha-unable-to-login"}),s(),a}function s(){i=u(r.controls.formId);n(i).irForm({success:l,failed:e,error:function(){e("Try again later")}});n(".{0}".f(r.controls.openFormButtonClass)).click(h)}function u(n){return"#{0}".f(n)}function h(){var t=u(r.controls.dialogId),i=r.controls.focusControl.name,f=r.controls.focusControl.id;c();AAT.utils.showModal(t,t+" [name="+i+"]",function(){(n.isRunningLowScreenByHeight()||!n(t).isFullyVisible())&&n(t+" label[for="+f+"]").irGoTo()})}function c(){n(i+" .send-message").show();n(i+" .message-has-sent").hide();n(i+" .alert-danger").hide();n(u(r.controls.dialogId)).fillData({Login:"",Email:"",Comments:"",PostalCode:""});n(i+" [name=DateOfBirth]").val("");n(i+" select").val("");f.reset()}function l(){n(i+" input[type=submit]").removeClass("disabled");n(i+" .send-message").hide();n(i+" .message-has-sent").show()}function e(t){f.reset();n(i+" input[type=submit]").removeClass("disabled");var r=n(i+" .alert-danger");r.html(t.Message||"An error occurred, please try again later");r.show()}var a={},r,v={},i,f;return o()}n.extend(!0,IR,{UnableToLogInControl:t})}(jQuery);window.IR==null&&(window.IR={}),function(n){function t(t){function f(r){var e;i[r]();var f=!0,o=null,u=n(t.container).find('[name="{0}"]:visible'.f(r));return u.attr("data-initialized")==undefined?(u.attr("data-initialized",!0),!1):(u&&u.length>0&&(f=u.irValidate({callbacks:{fail:function(n){o=n}}})),e=u.parent().parent().find(".fa-flag").toggleClass("orange",!f).toggleClass("green",f),e.off("mouseover"),f||e.off("mouseover").mouseover(function(){e.validationPopup({message:o})}),f)}function r(){return n(t.pageContent,t.container).find(":visible")}function e(){return u=new IR.RecaptchaManager({wrapperId:"recaptcha-register"}),n("[name=Password]",r()).passwordMeter({calculator:t.calculator}),n(t.container).find("form").irForm({success:function(){window.tokenChanged();n.redirect(t.urls.redirectUrl)},failed:function(n){r().errorMessage({error:n});u.reset()},beforeSend:function(){return r().irValidate()&&u.isValid()}}),u.reset(),i}var i=this,u;return i.Login=ko.observable(""),i.Password=ko.observable(""),i.RepeatPassword=ko.observable(""),i.ParentReferralCode=ko.observable(t.data.inviteCode),i.IsLoginValid=ko.pureComputed(function(){return f("Login")}),i.IsPasswordValid=ko.pureComputed(function(){return f("Password")}),i.IsRepeatPasswordValid=ko.pureComputed(function(){return f("RepeatPassword")}),i.validatePasswordStrength=function(){var n=r().find("[name=Password]").attr("data-password-strength");return{IsValid:n!=="Weak",Message:t.calculator.error.message,AutoHide:t.calculator.error.autoHide}},e()}n.extend(!0,IR,{RegisterPageModel:t})}(jQuery,IR.RegisterPageModel,{}),function(n){n.fn.passwordMeter=function(t){function u(){var t=r.val(),n=f(t);r.attr("data-password-strength",n.strength);i.progressBarContainer!=null&&h(n.strength,n.value)}function f(n){var r={strength:"Weak",value:0},t,u,f,h,c,l;if(n.length<i.calculator.minLength)r.strength="Weak";else if(n.length>=i.calculator.strongThreshold)r.strength="Strong";else{for(t=[0,0,0,0],u=0;u<n.length;u++)f=n[u],e(f)?t[0]++:o(f)?t[1]++:s(f)?t[2]++:t[3]++;for(h=0,c=0;c<t.length;c++)t[c]>0&&h++;h>=i.calculator.minRulesCount&&(r.strength=h>=i.calculator.strongRulesCount?"Strong":"Medium")}return l=n.length,r.strength=="Weak"&&(l=Math.min(l,i.calculator.minLength-1)),r.value=l,r}function e(n){return!isNaN(parseFloat(n))&&isFinite(n)}function o(n){var t=n.toLowerCase(),i=n.toUpperCase();return t==i?!1:n==t}function s(n){var i=n.toLowerCase(),t=n.toUpperCase();return i==t?!1:n==t}function h(t,r){var u=n(i.progressBarContainer),e=u.hasAttr("data-password-strength")?u.attr("data-password-strength"):"",o,f;e==""&&(u.append('<div class="progress"><div class="bar bar-danger" style="width: 1%"><\/div><\/div>'),u.append('<span class="password-strength"><\/span>'));e!=t&&(o=i.ui.progress[t],u.find(".bar").removeClass("bar-danger").removeClass("bar-warning").removeClass("bar-success").addClass(o.className),u.find("span").text(t),u.attr("data-password-strength",t));f=r*100/i.calculator.strongThreshold;f>100&&(f=100);t==="Strong"&&(f=100);u.find(".bar").attr("style","width: {0}%".f(f))}var i,r;return i=n.extend(!0,{progressBarContainer:null,calculator:{minLength:6,strongThreshold:15,minRulesCount:2,strongRulesCount:3},ui:{progress:{Weak:{width:20,className:"bar-danger"},Medium:{width:60,className:"bar-warning"},Strong:{width:100,className:"bar-success"}}}},t||{}),r=this,r.unbind("input").bind("input",u),u(),r}}(jQuery)